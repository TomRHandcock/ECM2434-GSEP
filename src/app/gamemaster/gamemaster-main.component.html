<!-- The navigations view (Author: George White) -->
<nav class="navbar" role="navigation" aria-label="Main navigation">
  <div class="navbar-brand">
    <div class="navbar-item">
      <span class="navbar-header">Gamemaster</span>
    </div>
    <a role="button" class="navbar-burger" aria-label="Menu" aria-expanded="false" (click)="showMenu = !showMenu">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="navbar-menu" [ngClass]="showMenu? 'is-active' : ''">
    <div class="navbar-end">
      <a class="navbar-item" (click)="this.gotoPlayerView();">
        Player View
      </a>
      <a class="navbar-item" (click)="changeScreen(this.Screens.OVERVIEW);">
        Overview
      </a>
      <a class="navbar-item" (click)="changeScreen(this.Screens.TEAMS);">
        Teams
      </a>
      <a class="navbar-item" (click)="changeScreen(this.Screens.QUESTIONS)">
        Questions
      </a>
      <a class="navbar-item" (click)="changeScreen(this.Screens.LOCATIONS)">
        Locations
      </a>
      <a class="navbar-item" (click)="changeScreen(this.Screens.QR)">
        QR Generation
      </a>
      <a class="navbar-item" (click)="signOut()">
        Sign out
      </a>
    </div>
  </div>
</nav>

<!---------------------------------------------------------------------------
  SCREEN CONTAINER

  The container for a shown view
  @author AlexWesterman
---------------------------------------------------------------------------->
<div class="container" [ngSwitch]="this.screen">

  <!---------------------------------------------------------------------------
    LOST POP UP

    The pop up dialog for notifying the game master that a team is lost
    @author OGWSaunders
  ---------------------------------------------------------------------------->
  <section class="section" id="overview" *ngSwitchCase="this.Screens.OVERVIEW">
    <app-scoreboard></app-scoreboard>
    <app-map id="map"></app-map>
    <!-- The lost alert popup (Author: OGWSanders) -->
    <div id="lostAlert" *ngIf="this.displayLost">
      <div id="lostAlertDisplay">
        <div id="titleLostDialog"><strong>Some teams have reported as lost</strong></div>
        <div id="lostTeamText">Lost Teams:<br/>{{this.lostTeamsText}}</div>
        <button class="button" (click)="this.displayLost = false">Close dialog</button>
      </div>
    </div>
  </section>

  <!---------------------------------------------------------------------------
    LOCATIONS

    The screen for
    @author AlexWesterman
  ---------------------------------------------------------------------------->
  <section class="section" id="locationsView" *ngSwitchCase="this.Screens.LOCATIONS">
    <table class="table questionTable is-fullwidth">
      <thead>
        <tr>
          <th>Name</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Loop through all locations and add them to the table -->
        <tr *ngFor="let item of this.locations">
          <td class="editCell"
            contenteditable="true"
            [(textContent)]="item.name">
          </td>
          <td class="editCell"
            contenteditable="true"
            [(textContent)]="item.latitude">
          </td>
          <td class="editCell"
            contenteditable="true"
            [(textContent)]="item.longitude">
          </td>
          <td class="editCell">
            <fa-icon class="locationAction" (click)="this.displayLocQrCode(item.name)" [icon]="qrCodeIcon"></fa-icon>
            <fa-icon class="locationAction" (click)="this.editLocation(item)" [icon]="editIcon"></fa-icon>
            <fa-icon class="locationAction" (click)="this.deleteLocation(this.numToString(item.name))" [icon]="deleteIcon"></fa-icon>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <td colspan="6" class="addNewQs" (click)="this.addNewLocation()">Add New Location</td>
      </tfoot>
    </table>

    <div id="qrHolder" *ngIf="this.displayLocQr">
      <div id="locationQrCodeDisplay">
        <qrcode [qrdata]="this.qrData" [width]="300" [errorCorrectionLevel]="'M'"></qrcode>
        <button id="locCopyId" class="button" (click)="this.copyText(this.qrData);">Text String: {{this.qrData}}</button>
        <button class="button" (click)="this.saveQrCode()">Save image</button>
        <button class="button" (click)="this.displayLocQr = false">Close dialog</button>
      </div>
    </div>

    <div id="descriptionHolder" *ngIf="this.displayLocDesc">
      <div id="locationDescDisplay">
        <h1 class="title is-4">Edit Description</h1>
        <textarea [(ngModel)]="this.selectedLocation.description" cols="30" rows="10"></textarea>
        <button class="button" (click)="this.onSubmitEditLocation()">Submit</button>
      </div>
    </div>
  </section>

  <!-- The QR code view (Author: AlexWesterman) -->
  <section id="QRView" *ngSwitchCase="this.Screens.QR">
    <table class="qr">
      <tr id="qrCode" *ngIf="this.qrData">
        <qrcode [qrdata]="this.qrData" [width]="256" [errorCorrectionLevel]="'M'"></qrcode>
      </tr>
      <tr id="qrString">{{this.qrData}}</tr>

      <tr>
        <button id="qrButton" class="button is-primary">
          <span class="icon is-small">
            <fa-icon [icon]="qrCodeIcon"></fa-icon>
          </span>
          <span (click)="this.generateQRCode()">Generate New QR Code</span>
        </button>
      </tr>
    </table>
  </section>

  <!-- The questions view (Author: AlexWesterman) -->
  <section class="section" id="questionsView" *ngSwitchCase="this.Screens.QUESTIONS">
    <div class="location" *ngFor="let item of this.questions | keyvalue">
      <!-- Also show location for grouping -->
      <h4 class="subtitle is-4">Location: {{item.key}}</h4>
      <table class="table is-fullwidth">
        <thead>
          <tr>
            <th>Question</th>
            <th>Answer 1 (Correct)</th>
            <th>Answer 2</th>
            <th>Answer 3</th>
            <th>Answer 4</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <!-- Loop through each question in that location -->
          <tr *ngFor="let question of item.value">
            <td><input type="text" name="question"   [(ngModel)]="question.question" (blur)="this.updateQuestion(item.key)"></td>
            <td><input type="text" name="correct"    style="color:lightgreen" [(ngModel)]="question.answer.correct" (blur)="this.updateQuestion(item.key)"></td>
            <td><input type="text" name="incorrect0" style="color:coral" [(ngModel)]="question.answer.incorrect0" (blur)="this.updateQuestion(item.key)"></td>
            <td><input type="text" name="incorrect1" style="color:coral" [(ngModel)]="question.answer.incorrect1" (blur)="this.updateQuestion(item.key)"></td>
            <td><input type="text" name="incorrect2" style="color:coral"  [(ngModel)]="question.answer.incorrect2" (blur)="this.updateQuestion(item.key)"></td>
            <td (click)="deleteQuestion(item.key, question.question)">
              <fa-icon [icon]="deleteIcon"></fa-icon>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <td style="text-align: center; cursor: pointer;" colspan="6" (click)="this.addNewQuestion(item.key)">+ Add a new question</td>
        </tfoot>
      </table>
    </div>
  </section>

  <!-- The teams view (Author: TomRHandcock) -->
  <section class="section" id="teamsView" *ngSwitchCase="this.Screens.TEAMS">
    <table class="table teamsTable is-fullwidth">
      <colgroup>
        <col>
        <col>
        <col>
        <col>
      </colgroup>
      <thead>
        <th>ID <fa-icon [icon]="sortIcon"></fa-icon></th>
        <th>Team Name <fa-icon [icon]="sortIcon"></fa-icon></th>
        <th>Score <fa-icon [icon]="sortIcon"></fa-icon></th>
        <th class="is-1">Actions</th>
      </thead>
      <tr *ngFor="let team of this.teams" class="is-hoverable">
        <td [(textContent)]="team.ID"></td>
        <td><input type="text" name="teamName" [(ngModel)]="team.name" (blur)="this.updateTeam(team.ID)"></td>
        <td><input type="number" name="teamScore" [(ngModel)]="team.score" (blur)="this.updateTeam(team.ID)"></td>
        <td>
          <fa-icon class="teamEdit" [icon]="mapIcon"></fa-icon>
          <fa-icon class="teamEdit" [icon]="editIcon"></fa-icon>
          <fa-icon class="teamEdit" [icon]="deleteIcon" (click)="this.deleteTeam(team.ID)" ></fa-icon>
        </td>
      </tr>
      <tfoot>
        <td style="text-align: center; cursor: pointer;" colspan="6" (click)="this.addNewTeam()">+ Add a new team</td>
      </tfoot>
    </table>
  </section>
</div>
